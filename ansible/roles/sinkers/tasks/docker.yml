- name: 'installing docker-py'
  pip: name=docker state=latest
  become: true
  tags: 'sinkers::docker'

- name: 'installing docker-compose'
  pip: name=docker-compose state=latest
  become: true
  tags: 'sinkers::docker'

- name: 'create Docker image directory'
  file:
    path: "{{ container_directory }}"
    state: directory
    mode: 0755
  tags: 'sinkers::docker'

- name: 'setting up containers as a service'
  copy:
      src: "{{ item.src }}"
      dest: "{{ item.dest }}"
      owner: root
      group: root
      mode: "{{ item.mode }}"
  with_items: "{{container_files}}"
  tags: 'sinkers::docker'

- name: 'starting up containerd'
  systemd:
    state: started
    name: containerd
    daemon_reload: yes
    enabled: yes
  tags: 'sinkers::docker'

- name: 'reloading containerd service'
  command: /usr/local/sbin/containerd stop
  when: docker_rebuild_force | default("false") | match("true")
  tags: 'sinkers::docker'

